# 应用配置 - 使用环境变量
spring.application.name=knowledge-service
spring.profiles.active=prod
server.port=${API_PORT:8081}

# 日志配置
logging.level.com.weichai.knowledge=INFO
logging.level.org.springframework.kafka=WARN
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
logging.file.name=logs/knowledge-service.log

# AOP切面启用
spring.aop.auto=true
spring.aop.proxy-target-class=true

# 服务配置
server.servlet.encoding.charset=UTF-8
server.servlet.encoding.enabled=true
server.servlet.encoding.force=true

# 监控配置
management.endpoints.web.exposure.include=health,info,prometheus
management.endpoint.health.show-details=when-authorized

# R2DBC响应式数据库配置 - 使用环境变量
spring.r2dbc.url=r2dbc:mysql://${MYSQL_HOST:10.3.80.24}:${MYSQL_PORT:32647}/${MYSQL_DATABASE:knowledge_db}
spring.r2dbc.username=${MYSQL_USER:knowledge}
spring.r2dbc.password=${MYSQL_PASSWORD:Weichai@123}
spring.r2dbc.pool.enabled=true
spring.r2dbc.pool.initial-size=5
spring.r2dbc.pool.max-size=20
spring.r2dbc.pool.max-idle-time=5m
spring.r2dbc.pool.max-life-time=20m
spring.r2dbc.pool.max-acquire-time=20s
spring.r2dbc.pool.max-create-connection-time=20s
spring.r2dbc.pool.validation-query=SELECT 1

# 注释掉JPA配置，因为使用R2DBC响应式数据库访问
# spring.jpa.hibernate.ddl-auto=update
# spring.jpa.show-sql=false
# spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
# spring.jpa.properties.hibernate.format_sql=true
# spring.jpa.properties.hibernate.jdbc.time_zone=Asia/Shanghai
# spring.jpa.open-in-view=false

# Redis配置 - 使用环境变量
spring.data.redis.host=${REDIS_HOST:10.3.80.24}
spring.data.redis.port=${REDIS_PORT:30223}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.database=${REDIS_DB:0}
spring.data.redis.timeout=2000ms
spring.data.redis.lettuce.pool.max-active=20
spring.data.redis.lettuce.pool.max-idle=10
spring.data.redis.lettuce.pool.min-idle=5
spring.data.redis.lettuce.pool.max-wait=2000ms

# Kafka配置 - 使用环境变量
spring.kafka.bootstrap-servers=${KAFKA_TEST_BOOTSTRAP_SERVERS:10.3.80.24:31946}
spring.kafka.consumer.group-id=${KAFKA_GROUP_ID:external-test-groupnew}
spring.kafka.consumer.auto-offset-reset=${KAFKA_AUTO_OFFSET_RESET:latest}
spring.kafka.consumer.enable-auto-commit=${KAFKA_ENABLE_AUTO_COMMIT:false}
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.max-poll-records=500
spring.kafka.consumer.max-poll-interval-ms=300000
spring.kafka.consumer.session-timeout-ms=30000
spring.kafka.consumer.heartbeat-interval-ms=3000
spring.kafka.consumer.properties.spring.json.trusted.packages=*
spring.kafka.consumer.properties.reconnect.backoff.ms=1000
spring.kafka.consumer.properties.reconnect.backoff.max.ms=10000
spring.kafka.consumer.properties.retry.backoff.ms=1000
spring.kafka.consumer.properties.request.timeout.ms=60000
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.listener.ack-mode=manual_immediate
spring.kafka.listener.missing-topics-fatal=false
spring.kafka.listener.type=batch

# 自定义应用配置 - 使用环境变量
app.database.host=${MYSQL_HOST:10.3.80.24}
app.database.port=${MYSQL_PORT:32647}
app.database.username=${MYSQL_USER:knowledge}
app.database.password=${MYSQL_PASSWORD:Weichai@123}
app.database.database=${MYSQL_DATABASE:knowledge_db}
app.database.charset=${MYSQL_CHARSET:utf8mb4}

app.redis.host=${REDIS_HOST:10.3.80.24}
app.redis.port=${REDIS_PORT:30223}
app.redis.password=${REDIS_PASSWORD:}
app.redis.database=${REDIS_DB:0}

app.kafka.bootstrap-servers=${KAFKA_TEST_BOOTSTRAP_SERVERS:10.3.80.24:31946}
app.kafka.group-id=${KAFKA_GROUP_ID:external-test-groupnew}
app.kafka.topic-prefix=${KAFKA_TEST_TOPIC_PREFIX:ZHENZHI_DATA_TEST_}
app.kafka.auto-offset-reset=${KAFKA_AUTO_OFFSET_RESET:latest}
app.kafka.enable-auto-commit=${KAFKA_ENABLE_AUTO_COMMIT:false}

app.api.base-url=${API_BASE_URL:http://10.74.32.195}
app.api.match-signature=${API_MATCH_SIGNATURE:5+fAMdUvi9IlKcuodRPaGAFRot/twrIq1hfRc5KYkFnVDoGI+q5TseWFxOQG5RBBHc2d0XTLoWHjXWX94rFOiPndW6//DI2txYIavp6KtDm7xNg23h7noGCCW/anHpdI}

app.space.guid=${SPACE_GUID:G6pmhUbcb5}

# 设置检查间隔（毫秒）
app.task.check-interval=1800000  # 30分钟 